<div class="container-fluid">
    <ng-form name="refProdCtrl.productDetailsForm" id="{{::refProdCtrl.repProductFormId}}">
        <cmp-error-summary form-ref="refProdCtrl.productDetailsForm" show-errors="refProdCtrl.showRecordSummary()"
                           form-preamble="{{::'CDN_REF_PRODUCT'|translate}}&nbsp{{refProdCtrl.recordIndex+1}}"
                           name-suffix="refProdCtrl.productDetailsForm" set-heading-level="h3"
                           make-focused="refProdCtrl.setSummaryFocus" alias-list="addressRec.alias"
                           update-errors="refProdCtrl.updateSummary"></cmp-error-summary>

        <fieldset>
            <legend>{{::'CDN_REF_PRODUCT'|translate}}&nbsp{{refProdCtrl.recordIndex+1}}</legend>
            <div class="row">
                <div class="col-md-4 form-group" ng-class="{'has-error':refProdCtrl.productDetailsForm[refProdCtrl.brandId].$invalid}">
                    <label for="{{::refProdCtrl.brandId}}" class="required"><span
                            class="field-name">{{::'BRAND_NAME'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>
                        <input type="text" id="{{::refProdCtrl.brandId}}" data-ng-model="refProdCtrl.productModel.brandName"
                               class="form-control full-width" name="{{::refProdCtrl.brandId}}" required maxlength="60"
                               size="60"/>
                        <cmp-error-message field-name="refProdCtrl.brandId" form-ref="refProdCtrl.productDetailsForm"
                                           show-error="refProdCtrl.showError(refProdCtrl.productDetailsForm[refProdCtrl.brandId])"
                                           error-types="refProdCtrl.requiredOnly"></cmp-error-message>
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-9 form-group"
                     ng-class="{'has-error':refProdCtrl.productDetailsForm[refProdCtrl.ingredNameId].$invalid}">
                    <label for="{{::refProdCtrl.ingredNameId}}" class="required"><span class="field-name">{{::'MEDICINAL_INGREDIENT'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>
                        <div class="rep-margin-top">
                            <input type="text" ng-model="refProdCtrl.productModel.ingLabel" name="{{::refProdCtrl.ingredNameId}}"
                                   id="{{::refProdCtrl.ingredNameId}}" size="100" maxlength="100"
                                   uib-typeahead=" rec.label for rec in refProdCtrl.activeList | filter:{label:$viewValue} | limitTo:15"
                                   class="form-control rep-normal-font" typeahead-show-hint="true"
                                   ng-change="refProdCtrl.ingredSelectionUpdated($item, $model, $label, $event)"
                                   typeahead-min-length="1" required typeahead-no-results="refProdCtrl.newIngred"
                                   typeahead-on-select="refProdCtrl.ingredSelectionUpdated($item, $model, $label, $event)"
                                   typeahead-popup-template-url="app/lib/uib-templates/customPopupTemplate.html"/>
                        </div>
                        <cmp-error-message field-name="refProdCtrl.ingredNameId" form-ref="refProdCtrl.productDetailsForm"
                                           show-error="refProdCtrl.showError(refProdCtrl.productDetailsForm[refProdCtrl.ingredNameId])"
                                           error-types="refProdCtrl.requiredOnly"></cmp-error-message>
                    </label>
                </div>
                <div class="col-md-3 form-group" ng-class="{'has-error':refProdCtrl.productDetailsForm[refProdCtrl.strengthId].$invalid}">
                    <label for="{{::refProdCtrl.strengthId}}" class="required"><span
                            class="field-name">{{::'STRENGTH'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>
                        <input type="number" id="{{::refProdCtrl.strengthId}}" data-ng-model="refProdCtrl.productModel.strengths"
                               class="form-control full-width" name="{{::refProdCtrl.strengthId}}" required ng-min="0"/>

                        <cmp-error-message field-name="refProdCtrl.strengthId" form-ref="refProdCtrl.productDetailsForm"
                                           show-error="refProdCtrl.showError(refProdCtrl.productDetailsForm[refProdCtrl.strengthId])"
                                           error-types="refProdCtrl.numberError"></cmp-error-message>
                        <!--<strong id="strengths-error" class="error"
                                ng-if="refProdCtrl.showError(refProdCtrl.productDetailsForm.strengths)">
                        <span class="label label-danger" ng-messages="refProdCtrl.productDetailsForm.strengths.$error">
                            <span ng-message="required"><span translate="MSG_ERR_MAND"></span></span>
                            <span ng-message="number"><span translate="MSG_ERR_INVALID_NUM"></span></span>
                             <span ng-message="min"><span translate="MSG_ERR_INVALID_NUM_MIN0"></span></span>
                        </span>
                        </strong>-->
                    </label>
                </div>
            </div>
            <div class="row">

                <div class="form-group col-md-3">
                    <label for="units_{{::$id}}" class="required full-width">
                        <span class="field-name">{{::'UNITS'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>

                        <div class="rep-pad-top">
                            <div class="rep-error" ng-class="{'has-error':refProdCtrl.productDetailsForm.nmUnits.$invalid}">
                                <ui-select ng-model="refProdCtrl.productModel.units" id="units_{{::$id}}" name="nmUnits"
                                           class="rep-selectize-font full-width" required>
                                    <ui-select-match placeholder="{{::'UNITS_SRCH' |translate}}"
                                                     class="rep-selectize-font form-control">
                                        {{$select.selected[refProdCtrl.lang]}}
                                    </ui-select-match>
                                    <ui-select-choices
                                            repeat="unitValue in refProdCtrl.unitsList | filter: {[refProdCtrl.lang]:$select.search}"
                                            class="rep-selectize-font">
                                        <span ng-bind-html="unitValue[refProdCtrl.lang] | highlight: $select.search"></span>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </div>
                        <strong id="units-error" class="error"
                                ng-if="refProdCtrl.showError(refProdCtrl.productDetailsForm.nmUnits)">
                        <span class="label label-danger"
                              ng-messages="refProdCtrl.productDetailsForm.nmUnits.$error">
                            <span ng-message="required"><span translate="MSG_ERR_MAND"></span></span>
                        </span>
                        </strong>
                    </label>
                </div>
                <div class="form-group col-md-4" ng-show="refProdCtrl.isUnitsOther()"
                     ng-class="{'has-error':refProdCtrl.productDetailsForm.otherUnits.$invalid}">
                    <label for="otherUnits_{{::$id}}" class="required"><span class="field-name">{{::'OTHER_UNITS'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>
                        <input type="text" id="otherUnits_{{::$id}}" data-ng-model="refProdCtrl.productModel.otherUnits"
                               size="40" class="form-control" name="otherUnits"
                               maxlength="40" ng-required="refProdCtrl.isUnitsOther()"/>
                        <strong id="unitsOther-error" class="error"
                                ng-if="refProdCtrl.showError(refProdCtrl.productDetailsForm.otherUnits)">
                        <span class="label label-danger" ng-messages="refProdCtrl.productDetailsForm.otherUnits.$error">
                            <span ng-message="required">{{::'MSG_ERR_MAND'|translate}}</span>
                        </span>
                        </strong>
                    </label>
                </div>
                <div class="form-group col-md-4">
                    <label for="per"><span class="field-name">{{::'PER_STRENGTH'|translate}}</span>
                        <input type="text" id="per" data-ng-model="refProdCtrl.productModel.per"
                               class="form-control" name="perVal" maxlength="40" size="40"/>
                    </label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-5 form-group">
                    <label for="dosage-form_{{::$id}}" class="required full-width">
                        <span class="field-name">{{::'DOSAGE_FORM'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>
                        <div class="rep-margin-top">
                            <div class="rep-error"
                                 ng-class="{'has-error':refProdCtrl.productDetailsForm.dosageForm.$invalid}">
                                <ui-select ng-model="refProdCtrl.productModel.dosageForm" id="dosage-form_{{::$id}}"
                                           name="dosageForm" class="rep-selectize-font full-width" ng-disabled="false"
                                           title="Choose a dosage form" required>
                                    <ui-select-match placeholder="Select or Search for a dosage form"
                                                     class="rep-selectize-font rep-selectize-dropdown form-control">
                                        {{$select.selected[refProdCtrl.lang]}}
                                    </ui-select-match>
                                    <ui-select-choices
                                            repeat="formType in refProdCtrl.dosageFormList | filter: {[refProdCtrl.lang]:$select.search}"
                                            class="rep-selectize-font">
                                        <span ng-bind-html="formType[refProdCtrl.lang] | highlight: $select.search"></span>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </div>
                        <strong id="dosageForm-error" class="error"
                                ng-if="refProdCtrl.showError(refProdCtrl.productDetailsForm.dosageForm)">
                        <span class="label label-danger" ng-messages="refProdCtrl.productDetailsForm.dosageForm.$error">
                            <span ng-message="required">{{::'MSG_ERR_MAND'|translate}}</span>
                        </span>
                        </strong>
                    </label>
                </div>
                <div class="col-md-5 form-group" ng-class="{'has-error':refProdCtrl.productDetailsForm.dosageOther.$invalid}"
                     ng-show="refProdCtrl.isDosageOther()">
                    <label for="dosage-form-other_((::$id}}" class="required">
                        <span class="field-name">{{::'DOSAGE_FORM_OTHER'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong>
                        <input type="text" id="dosage-form-other_((::$id}}"
                               data-ng-model="refProdCtrl.productModel.dosageFormOther"
                               class="form-control" name="dosageOther" ng-required="refProdCtrl.isDosageOther()"
                               maxlength="60" size="60"/>
                        <strong id="dosageOther-error" class="error"
                                ng-if="refProdCtrl.showError(refProdCtrl.productDetailsForm.dosageOther)">
                        <span class="label label-danger" ng-messages="refProdCtrl.productDetailsForm.dosageOther.$error">
                            <span ng-message="required">{{'MSG_ERR_MAND'|translate}}</span>
                        </span>
                        </strong>
                    </label>
                </div>

                <div class="col-md-12 form-group"
                     ng-class="{'has-error':refProdCtrl.productDetailsForm.companyName.$invalid}">
                    <label for="company-name_{{::$id}}" class="required"><span
                            class="field-name">{{::'COMPANY_NOABBREV'|translate}}</span>
                        <strong class="required">{{::"REQUIRED" |translate}}</strong></label>
                    <input type="text" id="company-name_{{::$id}}" data-ng-model="refProdCtrl.productModel.companyName"
                           class="form-control" name="companyName" required maxlength="60"
                           size="60"/>
                    <strong id="companyName-error" class="error"
                            ng-if="refProdCtrl.showError(refProdCtrl.productDetailsForm.companyName)">
                        <span class="label label-danger" ng-messages="refProdCtrl.productDetailsForm.companyName.$error">
                            <span ng-message="required">{{'MSG_ERR_MAND'|translate}}</span>
                        </span>
                    </strong>
                </div>
            </div>
            <!--    <pre>productModel : {{refProdCtrl.productModel | json}}</pre>-->
        </fieldset>

        <div class="row">

            <div class="btn-group-sm col-xs-12 text-right">
                <button class="btn btn-primary"
                        ng-click="refProdCtrl.saveProduct()" name="saveRef" id="saveRef">{{::'SAVE'|translate}}
                </button>
                <button ng-if="refProdCtrl.deleteBtn === true" class="btn btn-danger" ng-click="refProdCtrl.delete()" name="deleteRef" id="deleteRef">
                    {{::'DELETE'|translate}}
                </button>
                <button class="btn btn-default" id="discardRef" name="discrardRef"
                       ng-click="refProdCtrl.discardChanges()"> {{::'DISCARD_CHANGES'|translate}}
                </button>
            </div>
        </div>
    </ng-form>
</div>