<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<pre id="display"></pre>
<script src="../node_modules/diff/dist/diff.js"></script>
<script src="../node_modules/deep-diff/releases/deep-diff-0.3.4.min.js"></script>
<script>
    var one = 'beep boop',
        other = 'beep boob blah',
        color = '',
        span = null;

    var diff = JsDiff.diffChars(one, other),
        display = document.getElementById('display'),
        fragment = document.createDocumentFragment();

    /*var oldObj = {
        foo: 1,
        bar: "sunny ways",
        new2:{
            prop1:"foo"
        }
    };*/



    var oldObj=new Object();
    oldObj.foo=1;
    oldObj.bar="sunny ways";
    oldObj.prop1="foo2"
    //oldObj.new2=new Object();
    //oldObj.new2.prop1="foo";


    var newObj=new Object();
    newObj.foo=4;
    newObj.bar="sunny";
    newObj.prop1="foo";
    //newObj.new2=new Object();
    //newObj.new2.prop1="foo2323";

    oldObj={"ACTIVITY_ENROL":{"template_type":"PHARMA","company_id":"","dsts_control_number":"","enrolment_version":"0.2","date_saved":"2017-02-04","application_type":"NEW","software_version":"1.0.0","data_checksum":"","dossier_id_prefix":"HC6-024-","dossier_id":"","dossier_id_concat":"","reg_activity_lead":"","reg_activity_type":{"_label_en":"MPNC (Pre-NC Meeting)","_label_fr":"MPNC (Réunion préalable - PM)","__text":"B02-20160301-046"},"fee_class":"","reason_filing":"","is_third_party":"","is_admin_submission":"","notifiable_change_types":{"text_label_change":"N","drug_substance_change":"N","formulation_change":"N","specification_change":"N","expiry_storage_change":"N","manufact_method_change":"N","manufact_site_change":"N","container_size_change":"N","packaging_spec_change":"N","packaging_materials_change":"N","other_change_details":""},"rationale_types":{"new_roa":"N","new_claims":"N","change_formulation":"N","change_drug_substance":"N","replace_sterility":"N","confirmitory_studies":"N","other_rationale":"N","other_rationale_details":""},"contact_record":[{"foo":"bar"}]}};
    newObj={"ACTIVITY_ENROL":{"template_type":"PHARMA","hhh":"hhhh","dsts_control_number":"","enrolment_version":"0.2","date_saved":"2017-02-04","application_type":"AMEND","software_version":"1.0.1","data_checksum":"","dossier_id_prefix":"HC6-024-","dossier_id":"","dossier_id_concat":"","reg_activity_lead":"","reg_activity_type":{"_label_en":"MPNC (Pre-NC Meeting)","_label_fr":"MPNC (Réunion préalable - PM)","__text":"B02-20160301-047"},"fee_class":"","reason_filing":"","is_third_party":"","is_admin_submission":"","notifiable_change_types":{"text_label_change":"N","drug_substance_change":"N","formulation_change":"N","specification_change":"N","expiry_storage_change":"N","manufact_method_change":"N","manufact_site_change":"N","container_size_change":"N","packaging_spec_change":"N","packaging_materials_change":"N","other_change_details":""},"rationale_types":{"new_roa":"N","new_claims":"N","change_formulation":"N","change_drug_substance":"N","replace_sterility":"N","confirmitory_studies":"N","other_rationale":"N","other_rationale_details":""},"contact_record":[{"foo":"bar2"}]}}
//"company_id":"",
    oldObj2={"DOSSIER_ENROL":{"company_id":"","dossier_id":"","related_dossier_id":"","enrolment_version":"0.1","date_saved":"2017-02-07","application_type":"NEW","software_version":"1.0.0","data_checksum":"","contact_record":[],"dossier_type":"","brand_name":"","common_name":"","third_party_signed":"","is_ref_products":"","ref_product_list":{},"human_drug_use":"N","radiopharm_drug_use":"N","vet_drug_use":"N","disinfectant_drug_use":"N","therapeutic_class_list":{},"is_sched_a":"N","formulation_group":{"formulation_details":[]}}};
    newObj2={"DOSSIER_ENROL":{"company_id":"","dossier_id":"","related_dossier_id":"","enrolment_version":"0.1","date_saved":"2017-02-07","application_type":"NEW","software_version":"1.0.0","data_checksum":"","contact_record":[],"dossier_type":"","brand_name":"","common_name":"","third_party_signed":"","is_ref_products":"","ref_product_list":{},"human_drug_use":"N","radiopharm_drug_use":"N","vet_drug_use":"N","disinfectant_drug_use":"N","therapeutic_class_list":{},"is_sched_a":"N","formulation_group":{"formulation_details":[]}}};
    newObj3={"DOSSIER_ENROL":{"company_id":"","dossier_id":"","related_dossier_id":"","enrolment_version":"0.1","date_saved":"2017-02-07","application_type":"NEW","software_version":"1.0.0","data_checksum":"","contact_record":[{"amend_record":"N","rep_contact_role":"PRIMARY","rep_contact_details":{"salutation":"SALUT_DR","given_name":"asdsadsa","initials":"","surname":"asdasa","job_title":"dasdsad","language_correspondance":"en","phone_num":"111-111-1111","phone_ext":"","fax_num":"","email":"fsdfdfsd@asdsadas"}}],"dossier_type":"","brand_name":"","common_name":"","third_party_signed":"","is_ref_products":"","ref_product_list":{},"human_drug_use":"N","radiopharm_drug_use":"N","vet_drug_use":"N","disinfectant_drug_use":"N","therapeutic_class_list":{},"is_sched_a":"N","formulation_group":{"formulation_details":[]}}};
    newObj4={"DOSSIER_ENROL":{"company_id":"","dossier_id":"","related_dossier_id":"","enrolment_version":"0.1","date_saved":"2017-02-07","application_type":"NEW","software_version":"1.0.0","data_checksum":"","contact_record":[{"amend_record":"N","rep_contact_role":"PRIMARY","rep_contact_details":{"salutation":"SALUT_DR","given_name":"asdsadsa","initials":"","surname":"asdasa","job_title":"dasdsad","language_correspondance":"fr","phone_num":"111-111-1111","phone_ext":"","fax_num":"","email":"fsdfdfsd@asdsadas"}}],"dossier_type":"","brand_name":"","common_name":"","third_party_signed":"","is_ref_products":"","ref_product_list":{},"human_drug_use":"N","radiopharm_drug_use":"N","vet_drug_use":"N","disinfectant_drug_use":"N","therapeutic_class_list":{},"is_sched_a":"N","formulation_group":{"formulation_details":[]}}};

    function filter(obj1, obj2) {
        var result = {};
        for(key in obj1) {
            if(obj2[key] != obj1[key]) result[key] = obj2[key];
            if(typeof obj2[key] == 'array' && typeof obj1[key] == 'array')
                result[key] = arguments.callee(obj1[key], obj2[key]);
            if(typeof obj2[key] == 'object' && typeof obj1[key] == 'object')
                result[key] = arguments.callee(obj1[key], obj2[key]);
        }
        return result;
    }

    var isEmptyObject = function(obj) {
        var name;
        for (name in obj) {
            return false;
        }
        return true;
    };

    //http://stackoverflow.com/questions/8431651/getting-a-diff-of-two-json-objects
    var diff = function(obj1, obj2) {
        var result = {};
        var change;
        for (var key in obj1) {
           // console.log("The key "+key+" "+typeof obj2[key]);
             if (typeof obj2[key] == 'object' && typeof obj1[key] == 'object') {
                change = diff(obj1[key], obj2[key]);
                if (isEmptyObject(change) === false) {
                    result[key] = change;
                }
            }
            else if (obj2[key] != obj1[key]) {
                result[key] = obj2[key];
            }
        }
        return result;
    };





   // var test=filter(oldObj,newObj);
  /*  var test=diff(oldObj,newObj);
    console.log(test);
    var test2=diff(oldObj2,newObj3);
    console.log(test2);*/
    var result4=DeepDiff(newObj4,newObj3);
    console.log(result4);
    for(var g=0;g<result4.length;g++){
        var rec=result4[g];
        console.log("Type of change "+rec.kind);

        if(rec.kind==='A') {
            console.log("Change element "+rec.path[rec.path.length-1]);
            console.log("Type of change " + JSON.stringify(rec.item.kind));
            console.log("Original " + JSON.stringify(rec.item.lhs));
            console.log("Updated " + JSON.stringify(rec.item.rhs));
        }
    }


    /*var diffKeys=Object.keys(test.ACTIVITY_ENROL);
    for (var i = 0; i < diffKeys.length; i++) {
        var key=diffKeys[i];

      console.log(key+" has changed from "+JSON.stringify(oldObj.ACTIVITY_ENROL[key]) +" to "+JSON.stringify(newObj.ACTIVITY_ENROL[key]));

    }*/

   /* var diff2 = JsDiff.diffJson(oldObj, newObj,[{"ignoreWhitespace": true}]);
    console.log("++++++++++++++++++++++++++++++++++++++++++")
    console.log(diff2);

    var resultAdd={};
    var resultRemove={};
    var keysRemove=[];
    var keysAdd=[];
    diff2.forEach(function (part){
         if(part.added){
            var temp=part.value.trim();
            console.log("Part added "+temp);
            var tagList=temp.split(":");
            for(var j=0;j<tagList.length-1;j=j+2){
                console.log("TagList "+tagList[j]);
                keysAdd.push(tagList[j]);
                resultAdd[tagList[j]]=tagList[j+1];
             }
             keysAdd.push(tagList[0]);
             resultAdd[tagList[0]]=tagList[1];
       }else if(part.removed){
             var temp=part.value.trim();
             console.log("Part removed "+temp);
             var tagList=temp.split(":");
             resultRemove[tagList[0]]=tagList[1];
             keysRemove.push(tagList[0]);
       }
    });


    for(var i=0;i<keysRemove.length;i++){
        var key=keysRemove[i];
        if(resultAdd.hasOwnProperty(key)){
            console.log("This was changed "+key+" "+resultAdd[key]);
        }else{
            console.log("This was removed "+key+" "+resultAdd[key]);
        }
    }
    for(var i=0;i<keysAdd.length;i++){
        var key=keysAdd[i];
        if(!resultRemove.hasOwnProperty(key)){
            console.log("This was added "+key+" "+resultAdd[key]);
        }
    }*/


  /* var diff3= JsDiff.diffWords(JSON.stringify(oldObj),JSON.stringify(newObj));
    console.log("dddddd");
    console.log(diff3);
    diff3.forEach(function (part){
        if(part.added){
            console.log("this Part was added "+part.value);

        }else if(part.removed){
            console.log("this Part was removed "+part.value);
        }
    });
    diff.forEach(function (part) {
        // green for additions, red for deletions
        // grey for common parts
        color = part.added ? 'green' :
            part.removed ? 'red' : 'grey';
        span = document.createElement('span');
        span.style.color = color;
        span.appendChild(document
            .createTextNode(part.value));
        fragment.appendChild(span);
    });*/

    display.appendChild(fragment);
</script>

</body>
</html>